
<style type="text/css">
  .form .label{
    width:10.3%;
  }
  .form .text{
    width: 87%;
  }
  .form .col .label{
    width:22.5%;
  }
  .form .col .text{
    width: 68%;
  }
  .form .col .select{
    width: 70%;
  }
  .form fieldset{
    margin-left: .5em;
    margin-right: .5em;
  }
  .category-option{
    display : none;
  }
  select{
    height: 21px;
    vertical-align:middle;
  }
</style>
<%=stylesheet_link_tag 'ui/ui/jquery.autocomplete'%>
<%=javascript_include_tag 'ui/ui/jquery.autocomplete'%>
<script type="text/javascript">
  function changeIndex(timeGran){
    $("#kiplist").empty();
    $(".topn-index").empty();
    $("#kiplist").append("<option value=''>加载中...</option>");
    $.getJSON("/report/perf_templates/kpilist_candidate", { netgran: timeGran}, function(grans){
      $("#kiplist").empty();
      var selectedKpilists = "<%=@perf_template.kpilist.is_a?(Array) ? @perf_template.kpilist.join(",") : @perf_template.kpilist%>".split(",");
      for(var i=0; i<grans.length; i++){
        var gran = grans[i];
        var selected = $.inArray(gran.id + "", selectedKpilists);
        var option = ["<option value='" + gran.id + "'"];
        if(selected != -1)
          option.push(" selected='selected'");
        option.push("ename='" + gran.ename +"' unit='" + gran.unit + "'>" + gran.name + "</option>");
        $("#kiplist").append(option.join(""));
      }
      $("#kiplist").change();
      $("#topnkpi option[value=" + "<%=@perf_template.topn_kpi%>]").attr("selected", "selected");
    });
  }

  function checkDicGroup(){
    var checkedGroups = "<%=@perf_template.dic_group.is_a?(Array) ? @perf_template.dic_group.uniq.join(",") : @perf_template.dic_group%>".split(",");
    $.each(checkedGroups, function(i, group){
      if(group != "")
        $("input[value=" + group + "]").attr("checked", true).click().attr("checked", true);
    });
  }

  function checkTopn(){
    var topn = <%=@perf_template.is_topn.nil? ? 0 : @perf_template.is_topn%>;
    if(topn == 1){
      $("#topn-enabled").attr("checked", true).click().attr("checked", true);
    }else{
      $("#topn-enabled").attr("checked", false).click().attr("checked", false);
    }
  }

  function checkChartSet(){
    var chart_sets = "<%=chart_set_seqs.join(",")%>".split(",");
    $.each(chart_sets, function(i, chart_set){
      $("input[chart_name=chart" + chart_set + "]").attr("checked", true).click().attr("checked", true);
    });
  }

  function switchCategory(timeGran){
    changeIndex(timeGran);
    var checkedGroups = "<%=@perf_template.dic_group.is_a?(Array) ? @perf_template.dic_group.uniq.join(",") : @perf_template.dic_group%>".split(",");
    var parent = ""
    $("#porttype,#sw_device_type,#sw_device_manu,#ap_device_type,#ap_device_manu").attr("disabled", true);
    $(".category-option").css("display", "none").attr("disabled", true);
    $(".category-option").find("input").attr("disabled", true);
    if(timeGran == 0 || timeGran == 1 || timeGran == 2 || timeGran == 5 || timeGran == 3){
      $("#port_type_container").css("display", "block").attr("disabled", false).find("input").attr("disabled", false);
    }else if(timeGran == 9){
      $("#device_sw,#device-port").css("display", "block").attr("disabled", false).find("input").attr("disabled", false);
      parent = "#device_sw,#device-port";
    }else if (timeGran == 6 || timeGran == 7)
      $("#none").css("display", "block").attr("disabled", false).find("input").attr("disabled", false);
    else if (timeGran == 10)
      $("#device-port").css("display", "block").attr("disabled", false).find("input").attr("disabled", false);
    else if (timeGran == 11){
      $("#device_ap").css("display", "block").attr("disabled", false).find("input").attr("disabled", false);
      parent = "#device_ap";
    }
    if(parent != ""){
      $.each(checkedGroups, function(i, group){
        if(group != "")
          $(parent).find("input[value=" + group + "]").attr("checked", true).click().attr("checked", true);
      });
    }
  }
  function changeCandidateByNetGran(){
    $(".selected").empty();
    $(".candidate option[type=region-effect]").remove();
    $(".x_axis option[type=region-effect]").remove();
    var selectedOption = $("#region_gran option:selected")[0];
    var option = "<option type='region-effect' value='" + selectedOption.text + "'>" + selectedOption.text + "</option>";
    $(".candidate").append(option);
    $(".x_axis").append(option);
  }

  function changeRegionGran(regionGran){
    $("#busy_time option[value=-4]").remove();
    $("#busy_time").css({width:"258px",background:"#FFFFFF url(images/ui-bg_flat_0_FFFFFF_40x100.png) repeat scroll center center",border:"1px solid #BBD8E7",color:"#333333"});
  }

  function adjustGroupCol(){
    var chart_sets = window.eval('<%=@perf_template.chart_sets.to_json%>');
    $.each(chart_sets, function(i, chart_set){
      var chart = $("#chart" + chart_set.chart_seq + "-xcol");
      var groupColCandidate = $("#chart" + chart_set.chart_seq + "-candidate");
      var groupSelectedCol = $("#chart" + chart_set.chart_seq + "-selected");
      chart.attr("value", chart_set.x_col);
      groupColCandidate.find("option[value=" + chart_set.x_col + "]").remove();
      if(chart_set.group_col){
        if(!(chart_set.group_col instanceof Array))
          chart_set.group_col = chart_set.group_col.split(",");
        $.each(chart_set.group_col, function(i, col){
          groupColCandidate.find("option[value=" + col + "]").appendTo(groupSelectedCol.get()).attr("selected", true);
        });
      }
    })
  }
  function cancelUsers(){
    $("#perf_template_report_template_users option").attr("selected", false);
  }

  function is_checked(){
    var port = $("#port_type_enabled").attr("checked");
    var project = $("#project_state_enabled").attr("checked");
    var check = $("#check_state_enabled").attr("checked");
    var level = $("#site_level_enabled").attr("checked");
    var type = $("#sub_type_enabled").attr("checked");
    if(port == true || project == true || check == true || level == true || type == true ){
      changeIndex(3);
    }
    else{
      changeIndex(parseInt($("#region_gran").val()));
    }
  };

  $(function(){
    $(".cancelusers").click(function(e){
      cancelUsers();
    });
    $(".all_time").click(function(e){
      $(".time_gran").attr("checked", $(e.target).attr("checked"));
    });
    $(".region-effect").click(function(e){
      var e = $(e.target);
      if(e.attr("col_value") == "端口类型")
        return;
      if(e.attr("checked") == true){
        var option = "<option type='region-effect' value='" + e.attr("col_value") + "'>" + e.attr("col_value") + "</option>";
        $(".candidate").append(option);
        $(".x_axis").append(option);
      }else{
        $(".candidate option[value=" + e.attr("col_value")+ "]").remove();
        $(".x_axis option[value=" + e.attr("col_value")+ "]").remove();
      }
    });
    $("#region_gran").change(function(e){
      var regionGran = $("#region_gran option:selected").val();
      changeRegionGran(regionGran);
      switchCategory($(e.target).val());
      changeCandidateByNetGran();
      $(".region-effect").attr("checked", false);
      $(".region-effect-object").attr("disabled", true);
    });
    $(".chart-enabled").click(function(e){
      var e = $(e.target);
      var chartEnabledEffect = e.attr("chart_name");
      $("."+chartEnabledEffect).attr("disabled", !e.attr("checked"));
    });
    $(".mover").click(function(e){
      e = $(e.target);
      var direct = e.attr("direct");
      var candidate = e.attr("candidate");
      var selected = e.attr("selected");
      if(direct == "right"){
        var selectedOptions = $("#" + candidate + " option:selected");
        $.each(selectedOptions, function(i, option){
          $("#" + selected).append(option);
        })
      }else{
        var selectedOptions = $("#" + selected + " option:selected");
        $.each(selectedOptions, function(i, option){
          $("#" + candidate).append(option);
        })
      }
    });
    $(".x_axis").change(function(e){
      e = $(e.target);
      var except = e.attr("except");
      $("." + except + "-except option[value=" + e.val() + "]").remove();
      $("#" + except + "-candidate").empty();
      var selected = $("#" + except + "-selected option");
      $.each(e.children(), function(i, option){
        if(option.value != e.val() && option.value != ""){
          var notInSelected = true;
          $.each(selected, function(i, option1){
            if(option.value == option1.value){
              notInSelected = false;
              return;
            }
          })
          if(notInSelected)
            $("#" + except + "-candidate").append($(option).clone());
        }
      });
    });

    $("#port_type").change(function(){
      $.get("<%=url_for :controller => 'report/perf_reports', :action => 'options_sub_type',:format => 'ajax' %>",
      {"ids[]":$(this).val()},function(text){
        $("#sub_type").html(text);
      });
    });

    $('#ap_device_manu').change(function(){
      $.get("<%= url_for :controller => 'report/perf_reports', :action => 'options_ap_device_type', :format => 'ajax' %>",
      {id:$(this).val()},function(text){
        $("#ap_device_type").html(text);
      });
    });

    $('#sw_device_manu').change(function(){
      $.get("<%= url_for :controller => 'report/perf_reports', :action => 'options_sw_device_type', :format => 'ajax' %>",
      {id:$(this).val()},function(text){
        $("#sw_device_type").html(text);
      });
    });
    
    $(".querySwitch").click(function(e){
      $("#regionConditions,#portConditions").hide();
      $("#" + $(e.target).attr("ref")).show();
      $("#querySwitchCache").val($(e.target).attr("ref"));
      if ($(e.target).attr("ref") == 'portConditions'){
        changeIndex(3);
      }else{
        changeIndex(parseInt($("#region_gran").val()));
      }
    });
    
    $("#givenPorts").autocomplete('/report/perf_reports/search_ports', {
      width: 320,
      multiple: true,
      max : 30,
      matchContains: true,
      formatItem: function(row){return row[0];},
      formatResult: function(row){return row[0].replace(/(<.+?>)/gi, '');}
    });
    $("#regionConditions,#portConditions").hide();
    $("#<%=params[:query_switch]%>").show();
  })
</script>
<div class="f4">
  <input type="hidden" name="perf_template[report_type]" value="1"/>
  <input type="hidden" value="<%=params[:query_switch]%>" name="query_switch" id="querySwitchCache"/>
  <div class='wrap'>
    <div class='li'>
      <div class='left col'>
        <%=render :partial => '/report/statistics_time_period', :object =>@grid %>
      </div>
      <div class='right col' style="">
        <% field_set_tag '统计范围(<a class="querySwitch" ref="regionConditions" href="#">按区域</a>&nbsp;-&nbsp;<a ref="portConditions" class="querySwitch" href="#">按热点</a>)', :style => "padding: 5px;height:150px;", :class => "ui-widget-content ui-corner-all" do %>
          <div id="regionConditions">
            <%=render :partial=>'report/domain_selection'%>
            <input type="hidden" value="<%=net_loc%>" name="perf_template[netloc]" id="netloc" value=""/>

          </div>
          <div id="portConditions" style="padding: 5px;">
            <div>
              <font color="#000000">请输入热点名称,多个以","分隔</font><br/>
              <textarea name="ports" style="width:330px;height:90px;border:#bbd8e7 1px solid;" id="givenPorts"><%=params[:ports]%></textarea>
            </div>
          </div>
        <%end%>

        <input type="hidden" value="<%=params[:netloc_cns]%>" name="netloc_cns" id="netloc_cns" value=""/>
      </div>
    </div>
    <div class='li'>
      <div class='left col'>
        <%=f.label :time_gran,'时间粒度',:class=>'label', :required => true %>
        <%=f.select :time_gran, [["全部",7],["季度", 0],["月份",1],["周",2],["日期",3],["时段",4]], {:selected => @perf_template.time_gran.to_i}, {:id => "time_gran"}%>
      </div>
      <div class='left col' style="">
        <%=f.label :busytime,'忙时选项',:class=>'label', :required => true %>
        <%=f.select :busytime, busy_times(@perf_template.netloc_gran.to_i), {:selected => @perf_template.busytime.to_i}, {:id => "busy_time"}%>
      </div>
      <script type="text/javascript">
        function timeGranChanged(timeGran){
          var availableTimeGran = [];
          $(".time-gran-effect option[type=time-gran]").remove();
          $(".x_axis option[type=time-gran]").remove();
          $(".selected").empty();
          if(timeGran == 0){
            availableTimeGran[0] = "<option type='time-gran' value='年份'>年份</options>";
            availableTimeGran[1] = "<option type='time-gran' value='季度'>季度</options>";
          }else if(timeGran == 1){
            availableTimeGran[0] = "<option type='time-gran' value='年份'>年份</options>";
            availableTimeGran[1] = "<option type='time-gran' value='月份'>月份</options>";
          }else if(timeGran == 2){
            availableTimeGran[0] = "<option type='time-gran' value='年份'>年份</options>";
            availableTimeGran[1] = "<option type='time-gran' value='周'>周</options>";
          }else if(timeGran == 3){
            availableTimeGran[0] = "<option type='time-gran' value='日期'>日期</options>";
          }else if(timeGran == 4){
            availableTimeGran[0] = "<option type='time-gran' value='日期'>日期</options>";
            availableTimeGran[1] = "<option type='time-gran' value='时段'>时段</options>";
          }
          $(".candidate").append(availableTimeGran.join(""));
          $(".x_axis").append(availableTimeGran.join(""));
        }
        $(function(){
          $("#time_gran").change(function(e){
            var timeGran = $("#time_gran option:selected").val();
            timeGranChanged(timeGran);
          });
          timeGranChanged($("#time_gran option:selected").val());
        })
      </script>
    </div>
    <div class='li'>
      <div class='left col'>
        <%=f.label 'netloc_gran','区域粒度',:class=>'label', :required => true %>
        <%=f.select :netloc_gran, netloc_grans, {:selected => @perf_template.netloc_gran.to_i}, {:id => "region_gran"}%>
      </div>
    </div>
    <div class='li'>
      <div class='left col'>
        <% field_set_tag '分类选项', :style => "padding: 5px;height:410px;", :class => "ui-widget-content ui-corner-all" do %>
          <%selections = dic_group_selections%>
          <div id="none" style="" class="category-option">
            当前没有分类选项可配置
          </div>
          <div id="port_type_container" style="" class="category-option">
            <div style="float:left;width:48%">
              <div style="float:left;white-space:nowrap;">
                <input id="port_type_enabled" type="checkbox" class="region-effect" col_value="热点类型" value="port_type" name="perf_template[dic_group][]" style="float:left">
                <label for="port_type_enabled" style="float:left;text-align:left;" class="label">热点类型</label>
              </div>
              <%=select_tag "perf_template[group_original][port_type]", options_for_select(Rms::ReportTemplateCandidate.port_type_candidates, selections[:port_type]||'全部'),
                {:multiple => true, :class=>" region-effect-object", :style => "width: 100%;height:108px;", :id=>"port_type"}%>
            </div>
            <div style="float:left;width:48%;margin-left:10px;">
              <div style="float:left;white-space:nowrap;">
                <input id="sub_type_enabled" type="checkbox" class="region-effect" col_value="热点小类" value="sub_type" name="perf_template[dic_group][]" style="float:left">
                <label for="sub_type_enabled" style="float:left" class="label">热点小类</label>
              </div>
              <%=select_tag "perf_template[group_original][sub_type]", options_for_select(Rms::ReportTemplateCandidate.sub_type_candidates, selections[:sub_type]||"全部"),
                {:multiple => true, :class=>" region-effect-object", :style => "width: 100%; height:108px;",:id=>'sub_type'}%>
            </div>
            <div style="float:left;width:48%;margin-right:10px;">
              <div style="float:left;white-space:nowrap;">
                <input id="site_level_enabled" type="checkbox" class="region-effect" col_value="热点等级" value="site_level" name="perf_template[dic_group][]" style="float:left"/>
                <label for="site_level_enabled" style="float:left" class="label">热点等级</label>
              </div>
              <%=select_tag "perf_template[group_original][site_level]", options_for_select(Rms::ReportTemplateCandidate.site_level_candidates, selections[:site_level]||"全部"),
                {:multiple => true, :class=>" region-effect-object", :style => "width: 100%; height:108px;",:id=>'site_level'}%>
            </div>
            <% if @current_user.domain.base.include?("shanxi") || @current_user.domain.base.include?("yunnan")  %>
              <div style="float:left;width:48%;">
                <div style="float:left;white-space:nowrap;">
                  <input id="project_state_enabled" type="checkbox" class="region-effect" col_value="工程状态" value="project_state" name="perf_template[dic_group][]" style="float:left"/>
                  <label for="project_state_enabled" style="float:left" class="label">工程状态</label>
                </div>
                <%=select_tag "perf_template[group_original][project_state]", options_for_select(Rms::ReportTemplateCandidate.project_status_candidates, selections[:project_state]||"全部"),
                  {:multiple => true, :class=>" region-effect-object", :style => "width: 100%; height:108px;",:id=>'project_state'}%>
              </div>
            <% end %>
            <% if @current_user.domain.base.include?("yunnan") || @current_user.domain.base.include?("jilin") %>
              <div style="float:left;width:48%">
                <div style="float:left;white-space:nowrap;">
                  <input id="check_state_enabled" type="checkbox" class="region-effect" col_value="验收状态" value="check_state" name="perf_template[dic_group][]" style="float:left"/>
                  <label for="check_state_enabled" style="float:left;text-align:left;" class="label">验收状态</label>
                </div>
                <%=select_tag "perf_template[group_original][check_state]", options_for_select(Rms::ReportTemplateCandidate.check_state_candidates, selections[:check_state]||'全部'),
                  {:multiple => true, :class=>" region-effect-object", :style => "width: 100%;height:108px;", :id=>"check_state"}%>
              </div>
            <% end %>
            <script type="text/javascript">
              $(function(){
                $("#port_type,#sub_type,#site_level,#project_state,#check_state").attr("disabled", true);
                $("#port_type_enabled").click(function(e){
                  $("#port_type").attr("disabled", !$(e.target).attr("checked"));
                });
                $("#sub_type_enabled").click(function(e){
                  $("#sub_type").attr("disabled", !$(e.target).attr("checked"));
                });
                $("#site_level_enabled").click(function(e){
                  $("#site_level").attr("disabled", !$(e.target).attr("checked"));
                });
                $("#project_state_enabled").click(function(e){
                  $("#project_state").attr("disabled", !$(e.target).attr("checked"));
                });
                $("#check_state_enabled").click(function(e){
                  $("#check_state").attr("disabled", !$(e.target).attr("checked"));
                });
              })
            </script>
          </div>
          <div id="device_ap" style="" class="category-option">
            <div style="float:left;width:48%">
              <div style="float:left;white-space:nowrap;">
                <input id="ap_vendor_enabled" type="checkbox" class="region-effect" col_value="设备厂家" value="device_manu" name="perf_template[dic_group][]" style="float:left">
                <label for="ap_vendor_enabled" style="float:left" class="label">设备厂家</label>
              </div>
              <%=select_tag "perf_template[group_original][device_manu]", options_for_select(Rms::ReportTemplateCandidate.device_manu_candidates, selections[:device_manu]||"全部"),
                {:multiple => true, :class=>" region-effect-object", :style => "width: 100%; height:80px;",:id=>'ap_device_manu'}%>
            </div>
            <div style="float:left;width:48%;margin-left:10px;">
              <div style="float:left;white-space:nowrap;">
                <input id="ap_mode_enabled" type="checkbox" class="region-effect" col_value="设备型号" value="device_type" name="perf_template[dic_group][]" style="float:left">
                <label for="ap_mode_enabled" style="float:left" class="label">设备型号</label>
              </div>
              <%=select_tag "perf_template[group_original][device_type]", options_for_select(Rms::ReportTemplateCandidate.device_ap_kind, selections[:device_type]||"全部"),
                {:multiple => true, :class=>" region-effect-object", :style => "width: 100%; height:80px;",:id=>'ap_device_type'}%>
            </div>
          </div>
          <div id="device_sw" style="" class="category-option">
            <div style="float:left;width:48%">
              <div style="float:left;white-space:nowrap;">
                <input id="sw_vendor_enabled" type="checkbox" class="region-effect" col_value="设备厂家" value="device_manu" name="perf_template[dic_group][]" style="float:left">
                <label for="sw_vendor_enabled" style="float:left" class="label">设备厂家</label>
              </div>
              <%=select_tag "perf_template[group_original][device_manu]", options_for_select(Rms::ReportTemplateCandidate.device_manu_candidates, selections[:device_manu]||"全部"),
                {:multiple => true, :class=>" region-effect-object", :style => "width: 100%; height:80px;", :id=>"sw_device_manu"}%>
            </div>
            <div style="float:left;width:48%;margin-left:10px;">
              <div style="float:left;white-space:nowrap;">
                <input id="sw_mode_enabled" type="checkbox" class="region-effect" col_value="设备型号" value="device_type" name="perf_template[dic_group][]" style="float:left">
                <label for="sw_mode_enabled" style="float:left" class="label">设备型号</label>
              </div>
              <%=select_tag "perf_template[group_original][device_type]", options_for_select(Rms::ReportTemplateCandidate.device_sw_kind, selections[:device_type]||"全部"),
                {:multiple => true, :class=>" region-effect-object", :style => "width: 100%; height:80px;", :id=>"sw_device_type"}%>
            </div>
          </div>
          <div id="device-port" style="float:left;white-space:nowrap;margin-top:5px;" class=" clearfix category-option">
            <input id="switch_port_type_enabled" type="checkbox" class="region-effect" col_value="端口类型" value="porttype" name="perf_template[dic_group][]" style="float:left">
            <label for="switch_port_type_enabled" style="float:left;width:60px;" class="label">端口类型</label>
            <%=select_tag "perf_template[group_original][porttype]", options_for_select(Rms::ReportTemplateCandidate.porttype_candidates, (selections[:porttype].nil? ? [] : selections[:porttype].collect{|p|p.to_i})),
              {:style => "float:left;width:150px;", :id=>"porttype", :class=>" region-effect-object"}%>
          </div>
          <script type="text/javascript">
            $(function(){
              $("#sw_vendor_enabled").click(function(e){
                $("#sw_device_manu").attr("disabled", !$(e.target).attr("checked"));
              });
              $("#sw_mode_enabled").click(function(e){
                $("#sw_device_type").attr("disabled", !$(e.target).attr("checked"));
              });
              $("#ap_vendor_enabled").click(function(e){
                $("#ap_device_manu").attr("disabled", !$(e.target).attr("checked"));
              });
              $("#ap_mode_enabled").click(function(e){
                $("#ap_device_type").attr("disabled", !$(e.target).attr("checked"));
              });
              $("#switch_port_type_enabled").click(function(e){
                $("#porttype").attr("disabled", !$(e.target).attr("checked"));
              });
            })
          </script>
        <%end%>
      </div>
      <div class='right col' style="">
        <% field_set_tag "统计指标<a  style='cursor: hand;' onclick='countall();' class='countall'>(全选)</a><a style='cursor: hand;margin-left:10px;' href='/report/perf_reports/target_description' target='_blank'>指标说明</a>", :style => "padding: 5px;height:410px;", :class => "ui-widget-content ui-corner-all" do %>
          <%=f.select :kpilist, "", [], :multiple => true, :style => "height:395px;width:300px;margin-left:2.5%;border:none;", :id =>"kiplist"%>
        <%end%>
        <script type="text/javascript">
          $(function(){
            $("#kiplist").change(function(e){
              var selectedIndexes = $("#kiplist option:selected");
              $(".topn-index").empty();
              $.each(selectedIndexes, function(i, index){
                $(".topn-index").append("<option value='" + index.text + "'>" + index.text + "</option>");
              });
            });
          })
        </script>
      </div>
    </div>
    <div class='li'>
      <div class='left col' style="">
        <fieldset style="padding: 5px;height:150px;" class="ui-widget-content ui-corner-all">
          <legend>
            <%=f.check_box :is_topn, :style => "", :id => "topn-enabled", :class => " topon_enabled"%>
            <%=label "perf_template",:is_topn, "支持TopN", :for =>"topn-enabled", :style => ""%>
          </legend>
          <div style="" class="topn">
            <div class="li">
              <%=f.label :topn_kpi,'TopN指标', :class=>'label'%>
              <%=f.select :topn_kpi, [],{}, {:style=>"width:228px;", :id => "topnkpi", :class => " topn topn-index"}%>
            </div>
            <div class="li">
              <%=f.label :sort_type,'排序方式',:class=>'label'%>
              <%=f.select :sort_type, sort_types,{:selected => @perf_template.sort_type}, {:style=>"width:228px;",:class =>' topn'}%>
            </div>
            <div class="li">
              <%=f.label :top_n,'TopN值',:class=>'label'%>
              <%=text_field_tag "perf_template[top_n]", @perf_template.top_n, :id => "topn_val", :style=>"width:220px;", :class=>'topn number'%>
            </div>
          </div>
          <script type="text/javascript">
            $(function(){
              $(".topon_enabled").click(function(e){
                $(".topn").attr("disabled", !$(e.target).attr("checked"));
              });
              $(".number").keydown(function (e)  {
                if (e.which == 8 || e.which == 190){
                  return true;
                }else if(e.which!=0 && (e.which<48 || e.which>57))  {
                  return false;
                }
                if($(e.target).val().length > 5)
                  return false;
              });
              $("#topn_val").blur(function(){
                if ($("#topn_val").val() == 0){
                  alert("TopN值不能为0！");
                }
              });
            })
          </script>
        </fieldset>
      </div>
      <div class="right col">
        <%=render :partial => "/report/customize/index_filter"%>
      </div>
    </div>
    <div style="display:none;">
      <div id="filter_template">
        <div class="clearfix" style="margin: 5px;">
          <div class="left"><input id="{index_ename}" class="indexEnable" type="checkbox"/></div>
          <div class="left" style="width:150px;line-height: 20px;"><label for="{index_ename}">{index_name}</label></div>
          <div class="left" style="margin-left: 5px;"><%=select_tag "perf_template[index_filter][{index_ename}][op]", options_for_select([["大于",">"],["小于","<"],["等于", "="],["大于等于",">="],["小于等于","<="]]), :style => "width: 60px;", :id => "{index_ename}_op"%></div>
          <div class="left" style="margin-left: 5px;"><input onkeydown="return check_number(event)" id="{index_ename}_value" name="perf_template[index_filter][{index_ename}][value]" type="text" style="width: 60px;"/></div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      function check_number(e){
        if (e.keyCode == 8 || e.keyCode == 190){
          return true;
        }else if(e.keyCode!=0 && (e.keyCode<48 || e.keyCode>57))  {
          return false;
        }
      }
    </script>
  </div>
</div>
<script type="text/javascript">
  $(function(){
    checkDicGroup();
    checkTopn();
    checkChartSet();
    adjustGroupCol();
    switchCategory(<%=@perf_template.netloc_gran.nil? ? 1 : @perf_template.netloc_gran%>);
    changeCandidateByNetGran();
    $("#port_type_enabled,#project_state_enabled,#check_state_enabled,#site_level_enabled,#sub_type_enabled").click(function(){
      is_checked();
    });
    is_checked();
  })
  function topn(){
    var n = $(".number").val();
    if (n=0){
      alert("TopN的值不能为0!");
    }
  };
</script>
